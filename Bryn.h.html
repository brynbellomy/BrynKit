<!DOCTYPE html><html><head><title>Bryn.h</title><meta http-equiv="content-type" content="text/html; charset=UTF-8"><link rel="stylesheet" media="all" href="doc-style.css"><script src="doc-filelist.js"></script><script>var relativeDir = '', thisFile = '/Users/bryn/.otis/templates/tmpl.jade', defaultSidebar = true;</script><script src="doc-script.js"></script></head><body><div id="sidebar_wrapper"><div id="sidebar_switch"><span class="tree">Files</span><span class="headings">Headings</span></div><div id="tree"></div><div id="headings"><div class="heading h1"><a href="#settable-settings">Settable settings</a></div><div class="heading h1"><a href="#misc.-stuff">Misc. stuff</a></div><div class="heading h4"><a href="#key--">Key()</a></div><div class="heading h1"><a href="#typedefs">Typedefs</a></div><div class="heading h3"><a href="#blocks">Blocks</a></div><div class="heading h3"><a href="#enum-dispatchsourcestate">enum DispatchSourceState</a></div><div class="heading h1"><a href="#logging-and-debug-macros">Logging and debug macros</a></div><div class="heading h3"><a href="#color-logging">color logging</a></div><div class="heading h3"><a href="#predefined-rgb-colors">predefined rgb colors</a></div><div class="heading h3"><a href="#a-simple-predefined-color-logging--theme-">a simple predefined color logging 'theme'</a></div><div class="heading h3"><a href="#brynenablecolorlogging--">BrynEnableColorLogging()</a></div><div class="heading h3"><a href="#bryndisablecolorlogging--">BrynDisableColorLogging()</a></div><div class="heading h3"><a href="#__just_filename__">__JUST_FILENAME__</a></div><div class="heading h1"><a href="#image-related-macros">Image-related macros</a></div><div class="heading h3"><a href="#uiimagewithbundlepng--">UIImageWithBundlePNG()</a></div><div class="heading h1"><a href="#container-related-macros">Container-related macros</a></div><div class="heading h3"><a href="#seobjectatindex--">SEObjectAtIndex()</a></div><div class="heading h1"><a href="#objective-c-literals-on-ios--lt--6">Objective-c literals on iOS &lt; 6</a></div><div class="heading h1"><a href="#arc-non-arc-compatibility-helpers">ARC/non-ARC compatibility helpers</a></div><div class="heading h1"><a href="#gcd-concurrency-helpers">GCD/concurrency helpers</a></div><div class="heading h3"><a href="#dispatch_safe_sync--">dispatch_safe_sync()</a></div><div class="heading h1"><a href="#memory-tools">Memory tools</a></div><div class="heading h3"><a href="#get_free_memory--">get_free_memory()</a></div><div class="heading h3"><a href="#startoccasionalmemorylog--">startOccasionalMemoryLog()</a></div></div></div><div id="sidebar-toggle"></div><div id="container"><div class="background highlight"></div><table cellpadding="0" cellspacing="0"><tbody><tr><td class="docs"><h1>Bryn.h</h1></td><td class="code highlight"></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
</td><td class="code highlight"><div class="highlight"><pre><span class="cp">//</span>
<span class="cp">//  Bryn.h  </span>
<span class="cp">//  BrynKit</span>
<span class="cp">//  </span>
<span class="cp">//  Created by bryn austin bellomy on 7/18/12.  </span>
<span class="cp">//  Copyright (c) 2012 robot bubble bath LLC. All rights reserved.</span>
<span class="cp">//</span>

<span class="cp">#ifndef __Bryn__</span>
<span class="cp">#define __Bryn__  </span><span class="c1">// is this even possible????</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="settable-settings">
  <h1>
    <a href="#settable-settings" class="pilcrow">&#182;</a>
    Settable settings
  </h1>
</div>
</div><div class="body"><ul>
<li><strong>BRYNKIT_VERBOSE_NSLOG</strong>: if set to 1, this will add the filename and line num to NSLog calls</li>
<li><strong>BRYNKIT_SILENCE_NSLOG</strong>: if set to 1, all calls to NSLog become no-ops</li>
<li><strong>BRYNKIT_LOG_MACROS_ARE_ACTIVE</strong>: easily turn off all changes to logging</li>
<li><strong>BRYNKIT_NSLOG_TO_TESTFLIGHT</strong>: redirect all <code>NSLog()</code> calls to <code>TFLog()</code>, which sends them to TestFlight</li>
<li><strong>BRYNKIT_AUTOMATIC_LOG_COLORS</strong>: automatically colorize <code>NSLog()</code> output in the xcode console</li>
<li><strong>BRYNKIT_MB_PROGRESS_HUD_INCLUDED</strong>: set this to 1 if you want to use the <code>BrynShowMBProgressHUD()</code> helper function.</li>
</ul></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#pragma mark- settable settings</span>
<span class="cp">#pragma mark-</span>

<span class="cp">#ifndef BRYNKIT_VERBOSE_NSLOG</span>
<span class="cp">#  define BRYNKIT_VERBOSE_NSLOG 0</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef BRYNKIT_SILENCE_NSLOG</span>
<span class="cp">#  define BRYNKIT_SILENCE_NSLOG 0</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef BRYNKIT_LOG_MACROS_ARE_ACTIVE</span>
<span class="cp">#  define BRYNKIT_LOG_MACROS_ARE_ACTIVE 1</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef BRYNKIT_NSLOG_TO_TESTFLIGHT</span>
<span class="cp">#  define BRYNKIT_NSLOG_TO_TESTFLIGHT 0</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef BRYNKIT_AUTOMATIC_LOG_COLORS</span>
<span class="cp">#  define BRYNKIT_AUTOMATIC_LOG_COLORS 1</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef BRYNKIT_MB_PROGRESS_HUD_INCLUDED</span>
<span class="cp">#  define BRYNKIT_MB_PROGRESS_HUD_INCLUDED 1</span>
<span class="cp">#endif</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="misc.-stuff">
  <h1>
    <a href="#misc.-stuff" class="pilcrow">&#182;</a>
    Misc. stuff
  </h1>
</div>
</div><div class="body">
<div class="pilwrap" id="key--">
  <h4>
    <a href="#key--" class="pilcrow">&#182;</a>
    Key()
  </h4>
</div>


<p>Defines a pointer to a static NSString literal to be used for key-value stuff,
NSDictionary keys, etc.  Ex:</p>

<div class='highlight'><pre><code language=''>Key(MyNotificationUserInfoKey_Clowns);
// ...
NSLog(@"the clowns in the userinfo dictionary: %@", userInfo[MyNotificationUserInfoKey_Clowns]);
</code></pre></div></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">identifier</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#define Key(x) static NSString *const x = @ # x</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="typedefs">
  <h1>
    <a href="#typedefs" class="pilcrow">&#182;</a>
    Typedefs
  </h1>
</div>
</div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#pragma mark- typedefs</span>
<span class="cp">#pragma mark-</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="blocks">
  <h3>
    <a href="#blocks" class="pilcrow">&#182;</a>
    Blocks
  </h3>
</div>
</div><div class="body"><p>Saves a little bit of tedious typing.</p></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">typedef</span> <span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="n">BoolBlock</span><span class="p">)(</span><span class="kt">BOOL</span> <span class="n">success</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="n">UIntBlock</span><span class="p">)(</span><span class="n">NSUInteger</span> <span class="n">i</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="n">NotificationBlock</span><span class="p">)(</span><span class="n">NSNotification</span> <span class="o">*</span><span class="p">);</span>

<span class="k">@class</span> <span class="nc">MBProgressHUD</span>;  
<span class="k">typedef</span> <span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="n">SetupHUDBlock</span><span class="p">)</span>     <span class="p">(</span><span class="n">MBProgressHUD</span> <span class="o">*</span><span class="n">hud</span><span class="p">);</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="enum-dispatchsourcestate">
  <h3>
    <a href="#enum-dispatchsourcestate" class="pilcrow">&#182;</a>
    enum DispatchSourceState
  </h3>
</div>
</div><div class="body"><p>Use this to keep track of the state of <code>dispatch_source</code> objects so that you don't
over-resume them, try to cancel them when they're suspended, etc.</p></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">typedef</span> <span class="k">enum</span>
<span class="cp">#ifdef __IPHONE_6_0</span>
     <span class="o">:</span><span class="n">NSUInteger</span>
<span class="cp">#endif</span>
<span class="p">{</span>
  <span class="n">DispatchSourceState_Suspended</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>
  <span class="n">DispatchSourceState_Resumed</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span>
  <span class="n">DispatchSourceState_Canceled</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">}</span> <span class="n">DispatchSourceState</span><span class="p">;</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="logging-and-debug-macros">
  <h1>
    <a href="#logging-and-debug-macros" class="pilcrow">&#182;</a>
    Logging and debug macros
  </h1>
</div>
</div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#pragma mark- logging and debug macros</span>
<span class="cp">#pragma mark-</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="color-logging">
  <h3>
    <a href="#color-logging" class="pilcrow">&#182;</a>
    color logging
  </h3>
</div>
</div><div class="body"><p>These macros and <code>#define</code>s help to integrate with the XcodeColors plugin.</p>

<p><strong>IMPORTANT:</strong> XcodeColors currently only works with <code>lldb</code>.  If you're
using <code>gdb</code>, you'll just see a bunch of garbage surrounding your NSLog output.</p></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#define XCODE_COLORS_ESCAPE_OSX @&quot;\033[&quot;</span>
<span class="cp">#define XCODE_COLORS_ESCAPE_IOS @&quot;\xC2\xA0[&quot;</span>

<span class="cp">#define XCODE_COLORS_ESCAPE  XCODE_COLORS_ESCAPE_OSX</span>

<span class="cp">#define XCODE_COLORS_RESET_FG  XCODE_COLORS_ESCAPE @&quot;fg;&quot; </span><span class="c1">// Clear any foreground color</span>
<span class="cp">#define XCODE_COLORS_RESET_BG  XCODE_COLORS_ESCAPE @&quot;bg;&quot; </span><span class="c1">// Clear any background color</span>
<span class="cp">#define XCODE_COLORS_RESET     XCODE_COLORS_ESCAPE @&quot;;&quot;   </span><span class="c1">// Clear any foreground or background color</span>
<span class="cp">#define XCODE_COLORS_FG(r,g,b) XCODE_COLORS_ESCAPE @&quot;fg&quot; @#r @&quot;,&quot; @#g @&quot;,&quot; @#b @&quot;;&quot;</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="predefined-rgb-colors">
  <h3>
    <a href="#predefined-rgb-colors" class="pilcrow">&#182;</a>
    predefined rgb colors
  </h3>
</div>
</div><div class="body"><p>These macros evaluate to a regular NSString literal, so you can simply
concatenate them into an NSString expression like so:</p>

<p><code>NSLog(@"Blah blah" COLOR_RED @"This will be red" XCODE_COLORS_RESET @"This will not");</code></p></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#define COLOR_RED      XCODE_COLORS_FG(178,34,34)</span>
<span class="cp">#define COLOR_YELLOW   XCODE_COLORS_FG(255,185,0)</span>
<span class="cp">#define COLOR_OLIVE    XCODE_COLORS_FG(85,107,47)</span>
<span class="cp">#define COLOR_GREEN    XCODE_COLORS_FG(34,139,34)</span>
<span class="cp">#define COLOR_PURPLE   XCODE_COLORS_FG(132,112,255)</span>
<span class="cp">#define COLOR_BLUE     XCODE_COLORS_FG(30,144,255)</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="a-simple-predefined-color-logging--theme-">
  <h3>
    <a href="#a-simple-predefined-color-logging--theme-" class="pilcrow">&#182;</a>
    a simple predefined color logging 'theme'
  </h3>
</div>
</div><div class="body"><p>Just as with the predefined RGB colors above, you can concatenate
these into a plain ol' NSString expression:</p>

<p><code>NSLog(COLOR_ERROR(@"You screwed up") @"... but it'll be okay.");</code></p></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#define COLOR_ERROR(x)    COLOR_RED    x XCODE_COLORS_RESET</span>
<span class="cp">#define COLOR_SUCCESS(x)  COLOR_GREEN  x XCODE_COLORS_RESET</span>
<span class="cp">#define COLOR_FILENAME(x) COLOR_PURPLE x XCODE_COLORS_RESET</span>
<span class="cp">#define COLOR_LINE(x)     COLOR_YELLOW x XCODE_COLORS_RESET</span>
<span class="cp">#define COLOR_FUNC(x)     COLOR_BLUE   x XCODE_COLORS_RESET</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="brynenablecolorlogging--">
  <h3>
    <a href="#brynenablecolorlogging--" class="pilcrow">&#182;</a>
    BrynEnableColorLogging()
  </h3>
</div>
</div><div class="body"><p>Enables XcodeColors (you obviously have to install it too).  Call this from
your <code>main()</code> function, or something else sufficiently early.</p></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#define BrynEnableColorLogging() setenv(&quot;XcodeColors&quot;, &quot;YES&quot;, 0);</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="bryndisablecolorlogging--">
  <h3>
    <a href="#bryndisablecolorlogging--" class="pilcrow">&#182;</a>
    BrynDisableColorLogging()
  </h3>
</div>
</div><div class="body"><p>Disables XcodeColors.</p></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#define BrynDisableColorLogging() setenv(&quot;XcodeColors&quot;, &quot;NO&quot;, 0);</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="__just_filename__">
  <h3>
    <a href="#__just_filename__" class="pilcrow">&#182;</a>
    __JUST_FILENAME__
  </h3>
</div>
</div><div class="body"><p><code>__FILE__</code> contains the entire path to a file.  this <code>#define</code> only gives you the file's actual name.</p></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#define __JUST_FILENAME__ [[NSString stringWithUTF8String:__FILE__] lastPathComponent]</span>



<span class="cp">#if BRYNKIT_LOG_MACROS_ARE_ACTIVE == 1</span>

<span class="cp">  // redirect all NSLog() calls to TFLog(), the TestFlight logging function</span>
<span class="cp">  #if BRYNKIT_NSLOG_TO_TESTFLIGHT == 1</span>
<span class="cp">    #define NSLog TFLog</span>
<span class="cp">  #endif</span>

<span class="cp">  // this is the macro that replaces NSLog if you have BRYNKIT_VERBOSE_NSLOG set to 1.  if you want to use it</span>
<span class="cp">  // without replacing NSLog, leave BRYNKIT_VERBOSE_NSLOG set to 0 and just call BrynLog.</span>
<span class="cp">  #if BRYNKIT_AUTOMATIC_LOG_COLORS == 1</span>
<span class="cp">    #define BrynLog(__FORMAT__, ...) (NSLog(@&quot;[&quot; COLOR_FILENAME(@&quot;%@&quot;) @&quot;:&quot; COLOR_LINE(@&quot;%d&quot;) @&quot;] %@&quot;, \</span>
<span class="cp">                                              __JUST_FILENAME__, __LINE__, [NSString stringWithFormat:__FORMAT__, ##__VA_ARGS__]))</span>
<span class="cp">  #else</span>
<span class="cp">    #define BrynLog(__FORMAT__, ...) (NSLog(@&quot;[%@:%d] %@&quot;, __JUST_FILENAME__, __LINE__, [NSString stringWithFormat:__FORMAT__, ##__VA_ARGS__]))</span>
<span class="cp">  #endif</span>

<span class="cp">  // replace NSLog with BrynLog</span>
<span class="cp">  #if BRYNKIT_VERBOSE_NSLOG == 1</span>
<span class="cp">    #define NSLog(__FORMAT__, ...) BrynLog(__FORMAT__, ##__VA_ARGS__)</span>
<span class="cp">  #endif</span>

<span class="cp">  // replace NSLog with a no-op</span>
<span class="cp">  #if BRYNKIT_SILENCE_NSLOG == 1</span>
<span class="cp">    #define NSLog(__FORMAT__, ...) do{}while(0)</span>
<span class="cp">  #endif</span>

<span class="cp">  // like BrynLog except it logs the function/selector name instead of the file and line num.</span>
<span class="cp">  #if BRYNKIT_AUTOMATIC_LOG_COLORS == 1</span>
<span class="cp">    #define BrynFnLog(__FORMAT__, ...) (NSLog( \</span>
<span class="cp">                                          COLOR_FUNC(@&quot;%s &quot;) @&quot;%@&quot;, \</span>
<span class="cp">                                          __func__, [NSString stringWithFormat:(__FORMAT__), ##__VA_ARGS__]))</span>
<span class="cp">  #else</span>
<span class="cp">    #define BrynFnLog(__FORMAT__, ...) (NSLog(@&quot;%s %@&quot;, __func__, [NSString stringWithFormat:(__FORMAT__), ##__VA_ARGS__]))</span>
<span class="cp">  #endif</span>
<span class="cp">#else</span>

<span class="cp">  #define BrynLog(__FORMAT__, ...) do{}while(0)</span>
<span class="cp">  #define BrynFnLog(__FORMAT__, ...) do{}while(0)</span>

<span class="cp">#endif</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="image-related-macros">
  <h1>
    <a href="#image-related-macros" class="pilcrow">&#182;</a>
    Image-related macros
  </h1>
</div>
</div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#pragma mark- image-related macros</span>
<span class="cp">#pragma mark-</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="uiimagewithbundlepng--">
  <h3>
    <a href="#uiimagewithbundlepng--" class="pilcrow">&#182;</a>
    UIImageWithBundlePNG()
  </h3>
</div>
</div><div class="body"><p>Load a PNG file from the main bundle.  People use +[UIImage imageNamed:]
because it's much easier than the (minimum) method calls you have to make to
load a UIImage the 'right' way.  With a macro like this, there's no excuse.
Note: the image filename you pass to this macro should not contain its file
extension (".png").</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSString*</span><code class="name">filename</code> &mdash; <span class="description">The filename of the image without its ".png" extension.</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#if !defined(UIImageWithBundlePNG)</span>
<span class="cp">  #define UIImageWithBundlePNG(x) ([UIImage imageWithContentsOfFile: [[NSBundle mainBundle] pathForResource:(x) ofType: @&quot;png&quot;]])</span>
<span class="cp">#endif</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="container-related-macros">
  <h1>
    <a href="#container-related-macros" class="pilcrow">&#182;</a>
    Container-related macros
  </h1>
</div>
</div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#pragma mark- container-related macros</span>
<span class="cp">#pragma mark-</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="seobjectatindex--">
  <h3>
    <a href="#seobjectatindex--" class="pilcrow">&#182;</a>
    SEObjectAtIndex()
  </h3>
</div>
</div><div class="body"><p>Calls <code>[array objectAtIndex:index]</code>, but first checks to make sure that the
array contains enough elements to even HAVE an object at the given index.
Warning: you may fail to notice bugs in your code when using this macro.
Exceptions get thrown for a reason, y'heard?</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">NSArray*</span><code class="name">array</code> &mdash; <span class="description">The array to be queried.</span></div><div class="dox_tag_detail"><span class="dox_type">NSUInteger</span><code class="name">index</code> &mdash; <span class="description">The index of the item.</span></div><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">NSObject*</span> &mdash; <span class="description">Either <code>nil</code> or the object at the specified index in the array.</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#if !defined (SEObjectAtIndex)</span>
<span class="cp">  #define SEObjectAtIndex(array, index) (array.count &gt;= (index + 1) ? array[ index ] : nil)</span>
<span class="cp">#endif</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="objective-c-literals-on-ios--lt--6">
  <h1>
    <a href="#objective-c-literals-on-ios--lt--6" class="pilcrow">&#182;</a>
    Objective-c literals on iOS &lt; 6
  </h1>
</div>
</div><div class="body"><p>This is just a band-aid until Xcode 4.5 is released.</p></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#pragma mark- objective-c literal support on iOS &lt; 6</span>
<span class="cp">#pragma mark-</span>

<span class="cp">// Shorthand for boxed values until we can use `@(...)`</span>
<span class="cp">#if __has_feature(objc_boxed_expressions)</span>
<span class="cp">#  define b(x)  @(x)</span>
<span class="cp">#  define bu(x) @(x)</span>
<span class="cp">#  define bf(x) @(x)</span>
<span class="cp">#  define bd(x) @(x)</span>
<span class="cp">#  define bb(x) @(x)</span>
<span class="cp">#else</span>
<span class="cp">#  define b(x)  [NSNumber numberWithInteger:(x)]</span>
<span class="cp">#  define bu(x) [NSNumber numberWithUnsignedInteger:(x)]</span>
<span class="cp">#  define bf(x) [NSNumber numberWithFloat:(x)]</span>
<span class="cp">#  define bd(x) [NSNumber numberWithDouble:(x)]</span>
<span class="cp">#  define bb(x) [NSNumber numberWithBool:(x)]</span>
<span class="cp">#endif</span>


<span class="cp">#ifndef __IPHONE_6_0</span>

<span class="cp">  // redefining `YES` and `NO` allows us to use `@YES` and</span>
<span class="cp">  // `@NO` for `NSNumber`-ified `BOOL`s.  (Provided by James Webster on StackOverflow)</span>
<span class="cp">  #if __has_feature(objc_bool) </span>
<span class="cp">    #undef YES</span>
<span class="cp">    #undef NO </span>
<span class="cp">    #define YES __objc_yes </span>
<span class="cp">    #define NO __objc_no </span>
<span class="cp">  #endif </span>

  <span class="c1">// These methods are implemented in `Bryn.m`.</span>

  <span class="k">@interface</span> <span class="nc">NSArray</span> <span class="nl">(Indexing)</span>
  <span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nl">objectAtIndexedSubscript:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="n">idx</span><span class="p">;</span>
  <span class="k">@end</span>

  <span class="k">@interface</span> <span class="nc">NSMutableArray</span> <span class="nl">(Indexing)</span>
  <span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">setObject:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">obj</span> <span class="nl">atIndexedSubscript:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="n">idx</span><span class="p">;</span>
  <span class="k">@end</span>

  <span class="k">@interface</span>  <span class="nc">NSDictionary</span> <span class="nl">(Indexing)</span>
  <span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nl">objectForKeyedSubscript:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">key</span><span class="p">;</span>
  <span class="k">@end</span>

  <span class="k">@interface</span>  <span class="nc">NSMutableDictionary</span> <span class="nl">(Indexing)</span>
  <span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">setObject:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">obj</span> <span class="nl">forKeyedSubscript:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">key</span><span class="p">;</span>
  <span class="k">@end</span>

<span class="cp">#endif</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="arc-non-arc-compatibility-helpers">
  <h1>
    <a href="#arc-non-arc-compatibility-helpers" class="pilcrow">&#182;</a>
    ARC/non-ARC compatibility helpers
  </h1>
</div>
</div><div class="body"><p>everything in this section comes courtesy of the fantastic MBProgressHUD
class by matej bukovinski [<a href='http://github.com/jdg/MBProgressHUD'>http://github.com/jdg/MBProgressHUD</a>]</p></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#pragma mark- ARC/non-ARC compatibility helpers</span>
<span class="cp">#pragma mark-</span>


<span class="cp">#ifndef bryn_strong</span>
<span class="cp">  #if __has_feature(objc_arc)</span>
<span class="cp">    #define bryn_strong strong</span>
<span class="cp">  #else</span>
<span class="cp">    #define bryn_strong retain</span>
<span class="cp">  #endif</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef bryn_weak</span>
<span class="cp">  #if __has_feature(objc_arc_weak)</span>
<span class="cp">    #define   bryn_weak   weak</span>
<span class="cp">    #define __bryn_weak __weak</span>
<span class="cp">  #elif __has_feature(objc_arc)</span>
<span class="cp">    #define   bryn_weak   unsafe_unretained</span>
<span class="cp">    #define __bryn_weak __unsafe_unretained</span>
<span class="cp">  #else</span>
<span class="cp">    #define   bryn_weak   assign</span>
<span class="cp">    #define __bryn_weak __assign</span>
<span class="cp">  #endif</span>
<span class="cp">#endif</span>

<span class="cp">#if __has_feature(objc_arc)</span>
<span class="cp">  #define BrynAutorelease(exp) exp</span>
<span class="cp">  #define BrynRelease(exp) exp</span>
<span class="cp">  #define BrynRetain(exp) exp</span>
<span class="cp">#else</span>
<span class="cp">  #define BrynAutorelease(exp) [exp autorelease]</span>
<span class="cp">  #define BrynRelease(exp) [exp release]</span>
<span class="cp">  #define BrynRetain(exp) [exp retain]</span>
<span class="cp">#endif</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="gcd-concurrency-helpers">
  <h1>
    <a href="#gcd-concurrency-helpers" class="pilcrow">&#182;</a>
    GCD/concurrency helpers
  </h1>
</div>
</div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#pragma mark- GCD/concurrency helpers</span>
<span class="cp">#pragma mark-</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="dispatch_safe_sync--">
  <h3>
    <a href="#dispatch_safe_sync--" class="pilcrow">&#182;</a>
    dispatch_safe_sync()
  </h3>
</div>
</div><div class="body"><p>Exactly like <code>dispatch_sync()</code>, except that it prevents you from deadlocking
the current queue by calling <code>dispatch_sync()</code> on it.  If the <code>queue</code>
parameter turns out to be the current queue, it will just call <code>block()</code>.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span class="dox_type">dispatch_queue_t</span><code class="name">queue</code> &mdash; <span class="description">The queue on which to execute the block.</span></div><div class="dox_tag_detail"><span class="dox_type">dispatch_block_t</span><code class="name">block</code> &mdash; <span class="description">The block to execute.</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">dispatch_safe_sync</span><span class="p">(</span><span class="n">dispatch_queue_t</span> <span class="n">queue</span><span class="p">,</span> <span class="n">dispatch_block_t</span> <span class="n">block</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dispatch_get_current_queue</span><span class="p">()</span> <span class="o">==</span> <span class="n">queue</span><span class="p">)</span>
    <span class="n">block</span><span class="p">();</span>
  <span class="k">else</span>
    <span class="n">dispatch_sync</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">block</span><span class="p">);</span>
<span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="memory-tools">
  <h1>
    <a href="#memory-tools" class="pilcrow">&#182;</a>
    Memory tools
  </h1>
</div>
</div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#pragma mark- memory stuff (possibly not app store safe)</span>
<span class="cp">#pragma mark-</span>

<span class="cp">#if DEBUG</span>
<span class="cp">  #import &lt;mach/mach.h&gt;</span>
<span class="cp">  #import &lt;mach/mach_host.h&gt;</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="get_free_memory--">
  <h3>
    <a href="#get_free_memory--" class="pilcrow">&#182;</a>
    get_free_memory()
  </h3>
</div>
</div><div class="body"><p>Returns the amount of free memory on the device.</p></div><div class="details"><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">natural_t</span> &mdash; <span class="description">The amount of free memory in bytes.</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="k">static</span> <span class="kr">inline</span> <span class="n">natural_t</span> <span class="nf">get_free_memory</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">mach_port_t</span> <span class="n">host_port</span><span class="p">;</span>
    <span class="n">mach_msg_type_number_t</span> <span class="n">host_size</span><span class="p">;</span>
    <span class="n">vm_size_t</span> <span class="n">pagesize</span><span class="p">;</span>
    <span class="n">host_port</span> <span class="o">=</span> <span class="n">mach_host_self</span><span class="p">();</span>
    <span class="n">host_size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">vm_statistics_data_t</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">integer_t</span><span class="p">);</span>
    <span class="n">host_page_size</span><span class="p">(</span><span class="n">host_port</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pagesize</span><span class="p">);</span>
    <span class="n">vm_statistics_data_t</span> <span class="n">vm_stat</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">host_statistics</span><span class="p">(</span><span class="n">host_port</span><span class="p">,</span> <span class="n">HOST_VM_INFO</span><span class="p">,</span> <span class="p">(</span><span class="n">host_info_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">vm_stat</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">host_size</span><span class="p">)</span> <span class="o">!=</span> <span class="n">KERN_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Failed to fetch vm statistics&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cm">/* Stats in bytes */</span>
    <span class="n">natural_t</span> <span class="n">mem_free</span> <span class="o">=</span> <span class="n">vm_stat</span><span class="p">.</span><span class="n">free_count</span> <span class="o">*</span> <span class="n">pagesize</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">mem_free</span><span class="p">;</span>
  <span class="p">}</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="startoccasionalmemorylog--">
  <h3>
    <a href="#startoccasionalmemorylog--" class="pilcrow">&#182;</a>
    startOccasionalMemoryLog()
  </h3>
</div>
</div><div class="body"><p>Starts a GCD timer that spits out the memory currently available on the
device every few seconds.</p></div></div></td><td class="code highlight"><div class="highlight"><pre>  <span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">startOccasionalMemoryLog</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">dispatch_queue_t</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="n">DISPATCH_QUEUE_PRIORITY_DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    
    <span class="c1">// create our timer source</span>
    <span class="n">dispatch_source_t</span> <span class="n">timer</span> <span class="o">=</span> <span class="n">dispatch_source_create</span><span class="p">(</span><span class="n">DISPATCH_SOURCE_TYPE_TIMER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">queue</span><span class="p">);</span>
    <span class="n">NSUInteger</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// 3 seconds</span>
    <span class="n">dispatch_source_set_timer</span><span class="p">(</span><span class="n">timer</span><span class="p">,</span>
                              <span class="n">dispatch_time</span><span class="p">(</span><span class="n">DISPATCH_TIME_NOW</span><span class="p">,</span> <span class="n">step</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">),</span>
                              <span class="n">step</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">,</span>
                              <span class="n">step</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">);</span>
    
    <span class="n">dispatch_source_set_event_handler</span><span class="p">(</span><span class="n">timer</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
      <span class="n">natural_t</span> <span class="n">freeMemBytes</span> <span class="o">=</span> <span class="n">get_free_memory</span><span class="p">();</span>
<span class="cp">#if BRYNKIT_AUTOMATIC_LOG_COLORS == 1</span>
      <span class="n">NSLog</span><span class="p">(</span><span class="n">COLOR_OLIVE</span> <span class="s">@&quot;Free memory: %f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">XCODE_COLORS_RESET</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">freeMemBytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)));</span>
<span class="cp">#else</span>
      <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Free memory: %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">freeMemBytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)));</span>
<span class="cp">#endif</span>
    <span class="p">});</span>
    
    <span class="c1">// now that our timer is all set to go, start it</span>
    <span class="n">dispatch_resume</span><span class="p">(</span><span class="n">timer</span><span class="p">);</span>
  <span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#if BRYNKIT_MB_PROGRESS_HUD_INCLUDED == 1</span>
<span class="cp">  #import &lt;MBProgressHUD/MBProgressHUD.h&gt;</span>
  <span class="kt">void</span> <span class="n">BrynShowMBProgressHUD</span><span class="p">(</span><span class="n">UIView</span> <span class="o">*</span><span class="n">onView</span><span class="p">,</span> <span class="n">SetupHUDBlock</span> <span class="n">block_setupHUD</span><span class="p">,</span> <span class="n">dispatch_block_t</span> <span class="n">block_afterShowingHUD</span><span class="p">);</span>
<span class="cp">#endif</span>


<span class="cp">#endif </span><span class="c1">// __Bryn__</span>
</pre></div></td></tr></tbody></table></div></body></html>