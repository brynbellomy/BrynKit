<!DOCTYPE html><html><head><title>NSObject+BrynKitObjCRuntime.h</title><meta http-equiv="content-type" content="text/html; charset=UTF-8"><link rel="stylesheet" media="all" href="../doc-style.css"><script src="../doc-filelist.js"></script><script>var relativeDir = '../', thisFile = '/Users/bryn/.otis/templates/tmpl.jade', defaultSidebar = true;</script><script src="../doc-script.js"></script></head><body><div id="sidebar_wrapper"><div id="sidebar_switch"><span class="tree">Files</span><span class="headings">Headings</span></div><div id="tree"></div><div id="headings"><div class="heading h2"><a href="#example">Example</a></div></div></div><div id="sidebar-toggle"></div><div id="container"><div class="background highlight"></div><table cellpadding="0" cellspacing="0"><tbody><tr><td class="docs"></td><td class="code highlight"></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
<p>NSObject+BrynKitObjCRuntime.h
 BrynKit</p>

<p>Created by bryn austin bellomy on 7.27.13.
 Copyright (c) 2013 bryn austin bellomy. All rights reserved.</p></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#import &lt;Foundation/Foundation.h&gt;</span>

<span class="k">@interface</span> <span class="nc">NSObject</span> <span class="nl">(BrynKitObjCRuntime)</span> <span class="p">{}</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<div class="dox"><div class="summary"><hr /></div><div class="body"></div><div class="details"><div class="dox_tag_title">Name</div><div class="dox_tag_detail"></div><div class="dox_tag_title">---------------------------------------------------------------------------------------</div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#pragma mark- Method swizzling</span>
<span class="cp">#pragma mark-</span></pre></div></td></tr><tr><td class="docs"><div class="dox"><div class="summary">
<div class="pilwrap" id="example">
  <h2>
    <a href="#example" class="pilcrow">&#182;</a>
    Example
  </h2>
</div>
</div><div class="body"><p>Given a method signature like <code>- (NSString *) testMethod:(NSNumber *)someNum</code>, you can wrap a class's
implementation of that method like so (note that you have to cast the <code>IMP</code> return value to <code>void *</code>
at the moment):</p>


<div class="highlight"><pre><code>  <span class="nt">__block</span> <span class="nt">id</span><span class="o">(*</span> <span class="nt">originalImpl</span><span class="o">)(</span><span class="nt">id</span><span class="o">,</span> <span class="nt">SEL</span><span class="o">,</span> <span class="nt">NSNumber</span> <span class="o">*)</span> <span class="o">=</span> <span class="o">(</span><span class="nt">void</span> <span class="o">*)</span>
      <span class="cp">[</span><span class="nx">MyClass</span> <span class="nx">bk_wrapMethod</span><span class="p">:</span> <span class="p">@</span><span class="nx">selector</span><span class="p">(</span><span class="nx">testMethod</span><span class="p">:)</span>
                   <span class="nx">withBlock</span><span class="p">:</span> <span class="p">^</span><span class="nb">id</span> <span class="p">(</span><span class="nb">id</span> <span class="nx">_self</span><span class="p">,</span> <span class="nx">NSNumber</span> <span class="o">*</span><span class="nx">someNum</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">// do something special here</span>

      <span class="c1">// call the original implementation if you want</span>
      <span class="nb">id</span> <span class="n">retval</span> <span class="o">=</span> <span class="nx">originalImpl</span><span class="p">(</span> <span class="nx">_self</span><span class="p">,</span> <span class="p">@</span><span class="nx">selector</span><span class="p">(</span><span class="nx">testMethod</span><span class="p">:),</span> <span class="nx">someNum</span> <span class="p">);</span>

      <span class="c1">// change the return value if it suits your purposes</span>
      <span class="k">return</span> <span class="nx">retval</span><span class="p">;</span>

  <span class="p">}</span><span class="cp">]</span><span class="o">;</span>
</code></pre></div>

</div><div class="details"><div class="dox_tag_title">Return</div><div class="dox_tag_detail"><span class="dox_type">The</span> &mdash; <span class="description">IMP associated with the original method implementation.</span></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="o">+</span> <span class="p">(</span><span class="n">IMP</span><span class="p">)</span> <span class="nl">bk_wrapMethod:</span><span class="p">(</span><span class="kt">SEL</span><span class="p">)</span><span class="n">selector</span> <span class="nl">withBlock:</span><span class="p">(</span><span class="kt">id</span> <span class="p">(</span><span class="o">^</span><span class="p">)())</span><span class="n">block</span><span class="p">;</span>

<span class="k">@end</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<div class="dox"><div class="summary"><hr /></div><div class="body"></div><div class="details"><div class="dox_tag_title">Name</div><div class="dox_tag_detail"></div><div class="dox_tag_title">---------------------------------------------------------------------------------------</div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="cp">#pragma mark- Objective-C associated objects</span>
<span class="cp">#pragma mark-</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Objective-C wrapper for 10.6+ associated object API.</p></div><div class="body"><p>In Mac OS X Snow Leopard and iOS 3.0, Apple introduced an addition to the
 Objective-C Runtime called associated objects. Associated objects allow for the
 pairing of a random key and object pair to be saved on an instance.</p>

<p>In BlocksKit, associated objects allow us to emulate instance variables in the
 ategories we use.</p>

<p>Class methods also exist for each association. These associations are unique to
 each class, and exist for the lifetime of the application unless set to <code>nil</code>.
 Each class is a unique meta-object; the ultimate singleton.</p>

<p>Created by <a href="https://github.com/andymatuschak">Andy Matuschak</a> as
 <code>AMAssociatedObjects</code>.</p></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">@interface</span> <span class="nc">NSObject</span> <span class="nl">(BrynKit_AssociatedObjects)</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Strongly associates an object with the reciever.</p></div><div class="body"><p>The associated value is retained as if it were a property
 synthesized with <code>nonatomic</code> and <code>retain</code>.</p>

<p>Using retained association is strongly recommended for most
 Objective-C object derivative of NSObject, particularly
 when it is subject to being externally released or is in an
 <code>NSAutoreleasePool</code>.</p>

<p>@param value Any object.
 @param key A unique key pointer.</p></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">bk_associateValue:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">value</span> <span class="nf">withKey:</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span><span class="p">;</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Strongly associates an object with the receiving class.</p></div><div class="body"><p>@see associateValue:withKey:
 @param value Any object.
 @param key A unique key pointer.</p></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">bk_associateValue:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">value</span> <span class="nf">withKey:</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span><span class="p">;</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Strongly, thread-safely associates an object with the reciever.</p></div><div class="body"><p>The associated value is retained as if it were a property
 synthesized with <code>atomic</code> and <code>retain</code>.</p>

<p>Using retained association is strongly recommended for most
 Objective-C object derivative of NSObject, particularly
 when it is subject to being externally released or is in an
 <code>NSAutoreleasePool</code>.</p>

<p>@see associateValue:withKey:
 @param value Any object.
 @param key A unique key pointer.</p></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">bk_atomicallyAssociateValue:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">value</span> <span class="nf">withKey:</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span><span class="p">;</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Strongly, thread-safely associates an object with the receiving class.</p></div><div class="body"><p>@see associateValue:withKey:
 @param value Any object.
 @param key A unique key pointer.</p></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">bk_atomicallyAssociateValue:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">value</span> <span class="nf">withKey:</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span><span class="p">;</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Associates a copy of an object with the reciever.</p></div><div class="body"><p>The associated value is copied as if it were a property
 synthesized with <code>nonatomic</code> and <code>copy</code>.</p>

<p>Using copied association is recommended for a block or
 otherwise <code>NSCopying</code>-compliant instances like NSString.</p>

<p>@param value Any object, pointer, or value.
 @param key A unique key pointer.</p></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">bk_associateCopyOfValue:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">value</span> <span class="nf">withKey:</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span><span class="p">;</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Associates a copy of an object with the receiving class.</p></div><div class="body"><p>@see associateCopyOfValue:withKey:
 @param value Any object, pointer, or value.
 @param key A unique key pointer.</p></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">bk_associateCopyOfValue:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">value</span> <span class="nf">withKey:</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span><span class="p">;</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Thread-safely associates a copy of an object with the reciever.</p></div><div class="body"><p>The associated value is copied as if it were a property
 synthesized with <code>atomic</code> and <code>copy</code>.</p>

<p>Using copied association is recommended for a block or
 otherwise <code>NSCopying</code>-compliant instances like NSString.</p>

<p>@see associateCopyOfValue:withKey:
 @param value Any object, pointer, or value.
 @param key A unique key pointer.</p></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">bk_atomicallyAssociateCopyOfValue:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">value</span> <span class="nf">withKey:</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span><span class="p">;</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Thread-safely associates a copy of an object with the receiving class.</p></div><div class="body"><p>@see associateCopyOfValue:withKey:
 @param value Any object, pointer, or value.
 @param key A unique key pointer.</p></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">bk_atomicallyAssociateCopyOfValue:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">value</span> <span class="nf">withKey:</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span><span class="p">;</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Weakly associates an object with the reciever.</p></div><div class="body"><p>A weak association will cause the pointer to be set to zero
 or nil upon the disappearance of what it references;
 in other words, the associated object is not kept alive.</p>

<p>@param value Any object.
 @param key A unique key pointer.</p></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">bk_weaklyAssociateValue:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">value</span> <span class="nf">withKey:</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span><span class="p">;</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Weakly associates an object with the receiving class.</p></div><div class="body"><p>@see weaklyAssociateValue:withKey:
 @param value Any object.
 @param key A unique key pointer.</p></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">bk_weaklyAssociateValue:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">value</span> <span class="nf">withKey:</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span><span class="p">;</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Returns the associated value for a key on the reciever.</p></div><div class="body"><p>@param key A unique key pointer.
 @return The object associated with the key, or <code>nil</code> if not found.</p></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nf">bk_associatedValueForKey:</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span><span class="p">;</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Returns the associated value for a key on the receiving class.</p></div><div class="body"><p>@see associatedValueForKey:
 @param key A unique key pointer.
 @return The object associated with the key, or <code>nil</code> if not found.</p></div><div class="details"><div class="dox_tag_title"></div><div class="dox_tag_detail"></div></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">+</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nf">bk_associatedValueForKey:</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span><span class="p">;</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Returns the reciever to a clean state by removing all
 associated objects, releasing them if necessary.</p></div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">bk_removeAllAssociatedObjects</span><span class="p">;</span></pre></div></td></tr><tr><td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<div class="dox"><div class="summary"><p>Returns the recieving class to a clean state by removing
 all associated objects, releasing them if necessary.</p></div><div class="body"></div></div></td><td class="code highlight"><div class="highlight"><pre><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">bk_removeAllAssociatedObjects</span><span class="p">;</span>

<span class="k">@end</span>
</pre></div></td></tr></tbody></table></div></body></html>